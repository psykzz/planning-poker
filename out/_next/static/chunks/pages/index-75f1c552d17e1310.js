(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5728:function(e,r,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return s(6793)}])},6793:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return Y}});var o=s(5893),t=s(7294),n=s(9008),a=s.n(n),i=s(3416),c=s(782),l=s(2767);let d=(0,s(218).eI)("https://coinnqngrwlwlfhwtkih.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzNTI0Nzg1MCwiZXhwIjoxOTUwODIzODUwfQ.bsG7ieEq9-tpfwACvQ_T-5DTU-xWyX2fWb3JezQFqdg"),_=(e,r,s)=>d.from("".concat(r,":session_name=eq.").concat(e)).on("*",e=>{console.log("".concat(r," change received"),e),s(e)}).subscribe(),u=e=>{d.removeSubscription(e)},m="standard",f="point_sequence",v=async(e,r,s)=>{let{error:o}=await d.from("options").upsert([{key:r,value:(null==s?void 0:s.toString())||"",session_name:e}]);if(o&&!Array.isArray(o))throw Error(JSON.stringify(o))},h=async(e,r,s)=>{let{data:o,error:t}=await d.from("options").select("key,value,session_name").eq("session_name",e).eq("key",r);if(t&&!Array.isArray(t))throw Error(JSON.stringify(t));return(null==o?void 0:o.length)>0?o[0].value:s},w={"☕":-2,"?":-1},g={};for(let[e,r]of Object.entries(w))g[r.toString()]=e;let y=async(e,r,s)=>{let{error:o}=await d.from("scores").upsert([{score:s,user_id:r,session_name:e,updated_at:new Date,revealed:!1}]);if(o&&!Array.isArray(o))throw Error(JSON.stringify(o))},x=async(e,r)=>{let{error:s}=await d.from("scores").delete().match({session_name:e,user_id:r});if(s&&!Array.isArray(s))throw Error(JSON.stringify(s))},p=async e=>{let{error:r}=await d.from("scores").delete().match({session_name:e});if(r&&!Array.isArray(r))throw Error(JSON.stringify(r))},j=async(e,r)=>{let{error:s}=await d.from("scores").update({revealed:r}).eq("session_name",e);if(s&&!Array.isArray(s))throw Error(JSON.stringify(s))},k=async e=>{let{data:r,error:s}=await d.from("scores").select("user_id,score,revealed").eq("session_name",e);if(s&&!Array.isArray(s))throw Error(JSON.stringify(s));return r},N=async(e,r)=>{let{data:s,error:o}=await d.from("users").insert([{name:r,session_name:e}]);if(o&&!Array.isArray(o))throw Error(JSON.stringify(o));return s[0]},E=async(e,r,s)=>{if(!r)return;let{error:o}=await d.from("users").update({last_presence:s,session_name:e}).eq("id",r);if(o&&!Array.isArray(o))throw Error(JSON.stringify(o))},S=async e=>{let{data:r,error:s}=await d.from("users").select("*").eq("session_name",e);if(s&&!Array.isArray(s))throw Error(JSON.stringify(s));return r},b=async e=>{if(!e)return;let{data:r,error:s}=await d.from("users").select("*").eq("id",e);if(s&&!Array.isArray(s))throw Error(JSON.stringify(s));if((null==r?void 0:r.length)>0)return r[(null==r?void 0:r.length)-1]};var C=s(2703);let A=e=>{let{session:r,showScores:s,toggleScores:n,confirmEnabled:a,toggleConfirm:i,nextSequence:l,cycleSequence:d}=e,[_,u]=t.useState(!1);t.useEffect(()=>{_&&(0,c.Am)("Enabled Moderator controls!")},[_]);let m=e=>!a||window.confirm(e),f=()=>{document.querySelectorAll('[id^="score_val_"]').forEach(e=>{e.style.backgroundColor="",e.style.borderColor=""})},v=t.useCallback(()=>{n(!1),f(),p(r)},[r,n]),h=t.useCallback(()=>{v(),d()},[d,v]);return _?(0,o.jsxs)("div",{className:C.moderator_controls,children:[(0,o.jsx)("button",{className:C.moderator_notice,onClick:()=>u(!1),children:"Hide Moderator Controls"}),(0,o.jsxs)("div",{className:C.actions,children:[(0,o.jsx)("div",{className:C.reveal,onClick:()=>m("".concat(s?"Hide":"Reveal"," all cards?"))&&n(!0),children:s?"Hide":"Reveal"}),(0,o.jsx)("div",{className:C.reset,onClick:()=>m("Reset all cards?")&&v(),children:"Reset"})]}),(0,o.jsxs)("div",{className:C.options,children:[(0,o.jsxs)("div",{className:C.confirm,onClick:()=>m("Disable your confirmation dialog?")&&i(),children:[a?"Disable":"Enable"," Confirm"]}),(0,o.jsxs)("div",{className:C.sequence,onClick:()=>m("Use ".concat(l," cards?"))&&h(),children:["Use ",l," Cards"]})]})]}):(0,o.jsx)("button",{className:C.moderator_notice,onClick:()=>u(!0),children:"Show Moderator Controls"})};var I=s(5106);let O=e=>{let{options:r,session:s}=e,t=e=>{let r=JSON.parse(localStorage.getItem("user"));if(r.id&&("-"===e?x(s,r.id):y(s,r.id,w[e]||e),document.querySelectorAll('[id^="score_val_"]').forEach(e=>{e.style.backgroundColor="",e.style.borderColor=""}),"-"!==e)){let r=document.getElementById("score_val_".concat(w[e]||e));r&&(r.style.backgroundColor="var(--bg-color-2)",r.style.borderColor="var(--color-discord-blue)")}};return(0,o.jsx)("div",{className:I.card_container,children:(0,o.jsx)("div",{className:I.options,children:r.map(e=>(0,o.jsx)("div",{id:"score_val_".concat(w[e]||e),className:I.card,onClick:()=>t(e),children:e},"".concat(w[e]||e)))})})};var J=s(8255);let q=e=>{let r=e.length;if(!r)return NaN;let s=e.reduce((e,r)=>e+r)/r;return Math.sqrt(e.map(e=>Math.pow(e-s,2)).reduce((e,r)=>e+r)/r)},M=e=>e.reduce((e,r)=>e+r,0)/e.length,D=e=>{let{me:r,users:s,scores:n}=e,a=t.useMemo(()=>Math.min(...n.filter(e=>e.score>=0).map(e=>e.score)),[n]),i=t.useMemo(()=>Math.max(...n.filter(e=>e.score>=0).map(e=>e.score)),[n]),c=t.useMemo(()=>q(n.filter(e=>e.score>=0).map(e=>e.score)),[n]),l=t.useMemo(()=>M(n.filter(e=>e.score>=0).map(e=>e.score)),[n]),d={};null==n||n.forEach(e=>{d[e.user_id]=e});let _=n.length&&n.every(e=>e.revealed);null==s||s.sort((e,r)=>e.id.localeCompare(r.id));try{_&&(null==s||s.sort((e,r)=>{var s,o,t,n;return(null!==(t=null===(s=d[r.id])||void 0===s?void 0:s.score)&&void 0!==t?t:0)-(null!==(n=null===(o=d[e.id])||void 0===o?void 0:o.score)&&void 0!==n?n:0)}))}catch(e){console.error(e)}console.log({users:s});let u=()=>{localStorage.removeItem("user"),window.location.reload()},m=e=>{let{isMe:r,score:s}=e;return s?s.revealed||r?(0,o.jsx)("div",{className:J.score,children:g[s.score.toString()]||s.score}):(0,o.jsx)("div",{className:J.score,children:"?"}):(0,o.jsx)("div",{className:J.score,children:"-"})},f=e=>{let{user:s}=e,t=s.id===(null==r?void 0:r.id),n=d[s.id];return(0,o.jsxs)("div",{className:"".concat(J.user," ").concat(t&&J.self),children:[(0,o.jsxs)("div",{className:"".concat(J.name," ").concat(t&&J.me),onClick:()=>t&&window.confirm("Reset your name?")&&u(),children:[s.name," ",t&&"(You)"]}),(0,o.jsx)("div",{className:"".concat(J.card," ").concat(J.no_hover),children:(0,o.jsx)(m,{isMe:t,score:n})})]},s.id)};return(0,o.jsxs)("div",{className:"".concat(J.user_list," ").concat((null==s?void 0:s.length)>5&&J.two_columns," ").concat(_&&J.show_scores),children:[null==s?void 0:s.map(e=>(0,o.jsx)(f,{user:e},e.id)),!!_&&(0,o.jsxs)("div",{className:J.averages,children:[(0,o.jsx)("h3",{children:"Score Averages"}),(0,o.jsxs)("div",{children:["Highest: ",i]}),(0,o.jsxs)("div",{children:["Lowest: ",a]}),(0,o.jsxs)("div",{children:["Std Dev: ",c]}),(0,o.jsxs)("div",{children:["Average: ",l]})]})]})};var P=s(5126);let T={fibonacci:["-",1,2,3,5,8,13,21,34,55,89],scrum:["-","☕","?",0,1,2,3,5,8,13,20,40,100],standard:["-",1,2,3,4,5,6,7,8,9,10]},X=Object.keys(T).sort(),z=e=>{let[r,s]=(0,l.Z)();console.log({session:e});let n=t.useCallback(()=>s("".concat(window.location.origin).concat(window.location.pathname,"#").concat(e.sessionId)),[e,s]);return t.useEffect(()=>{r.value&&c.Am.success("Copied ".concat(r.value,"!"))},[r]),(0,o.jsx)("div",{className:P.copy_notice,onClick:n,children:"click to copy url"})},H=e=>{let{session:r,user:s}=e,[n,i]=t.useState(),[c,l]=t.useState([]),[d,w]=t.useState([]),[g,y]=t.useState(!0),[x,p]=t.useState(m),C=d.length&&d.every(e=>e.revealed),I=X[(X.indexOf(x)+1)%X.length],J=async e=>{let r=await S(e),s=new Date;l(r.filter(e=>{var r;return new Date(Date.UTC((r=e.last_presence.split(/\D+/))[0],--r[1],r[2],r[3],r[4],r[5],r[6]))>s.setSeconds(s.getSeconds()-30)}))},q=t.useCallback(async(e,r)=>{await E(e,r.id,new Date().toISOString()),await J(e)},[]),M=async(e,r)=>{let s=await b(r.id);if(s){i(s);return}i(await N(e,r.name))},P=async e=>{w(await k(e))},H=e=>{var r,s,o,t;let n=null===(r=e.new)||void 0===r?void 0:r.user_id,a={user_id:null===(s=e.new)||void 0===s?void 0:s.user_id,score:null===(o=e.new)||void 0===o?void 0:o.score,revealed:null===(t=e.new)||void 0===t?void 0:t.revealed};w(e=>[...e.filter(e=>e.user_id!==n),a])},R=e=>{var r;let s=null===(r=e.old)||void 0===r?void 0:r.user_id;w(e=>[...e.filter(e=>e.user_id!==s)])},U=async e=>{p(await h(e,f,m))};t.useEffect(()=>{let e=_(r,"scores",e=>{"DELETE"===e.eventType?R(e):H(e)});return P(r),()=>u(e)},[r]),t.useEffect(()=>{let e=_(r,"options",e=>{var r,s,o;switch(null===(r=e.new)||void 0===r?void 0:r.key){case"confirm":y((null===(s=e.new)||void 0===s?void 0:s.value)==="true");break;case f:p((null===(o=e.new)||void 0===o?void 0:o.value)||m);break;default:console.warn("Unknown option change",e)}});return U(r),()=>u(e)},[r]),t.useEffect(()=>{M(r,s)},[r,s]),t.useEffect(()=>{J(r),(null==n?void 0:n.id)&&localStorage.setItem("user",JSON.stringify(n))},[r,n]),t.useEffect(()=>{if(!n)return;let e=setInterval(()=>{q(r,n)},1e4);return q(r,n),()=>clearInterval(e)},[n,r,q]),t.useEffect(()=>{let e=()=>q(r,n);return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[n,r,q]);let B=t.useCallback(function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];console.log("Toggling scores",!C),e&&j(r,!C)},[r,C]),L=t.useCallback(()=>{console.log("Toggling confirm",!g),y(!g)},[g]),W=t.useCallback(()=>{console.log("Cycling sequence",I),v(r,f,I),p(I)},[r,I]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a(),{children:(0,o.jsxs)("title",{children:["Planning Poker - ",r]})}),(0,o.jsx)(z,{sessionId:r}),(0,o.jsx)(D,{me:n,users:c,scores:d}),(0,o.jsx)(O,{session:r,options:T[x]}),(0,o.jsx)(A,{session:r,showScores:C,toggleScores:B,confirmEnabled:g,toggleConfirm:L,nextSequence:I,cycleSequence:W})]})};var R=s(2924);let U=()=>{let[e,r]=t.useState(""),[s,n]=t.useState({}),a=()=>{r(window.location.hash.slice(1))},c=()=>{let e=JSON.parse(localStorage.getItem("user"));if(e){n(e);return}let r="";for(;""===r||!r;)r=prompt("Please enter your name");n({name:r})};return t.useEffect(()=>(window.addEventListener("hashchange",a),a(),c(),()=>window.removeEventListener("hashchange",a)),[]),t.useEffect(()=>{s!=={}&&localStorage.setItem("user",JSON.stringify(s))},[s]),(0,o.jsxs)("div",{className:"".concat(R.content," ").concat(e?R.has_session:""),children:[(0,o.jsx)("h1",{children:"Planning Poker"}),e?(0,o.jsx)(H,{user:s,session:e}):(0,o.jsx)("a",{onClick:()=>{window.location.hash=(0,i.x0)(7)},className:R.new_session,children:"Start new session"})]})};var B=s(8888);let L=()=>{let[e,r]=t.useState(!0);t.useEffect(()=>{let e=JSON.parse(window.localStorage.getItem("prefers-dark-mode"));null===e&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches),r(e)},[]),t.useEffect(()=>{e?(document.documentElement.classList.add("dark"),document.documentElement.setAttribute("data-theme","dark")):(document.documentElement.classList.remove("dark"),document.documentElement.setAttribute("data-theme","light"))},[e]);let s=()=>{r(!e),window.localStorage.setItem("prefers-dark-mode",JSON.stringify(!e))};return(0,o.jsx)("div",{id:"dm-toggle",className:"".concat(B.darkmode_toggle," ").concat(e?B.is_dark:""),onClick:()=>s(),onKeyPress:()=>s(),tabIndex:"0","aria-label":"Toggle darkmode",role:"button"})};var W=s(8447);let G=()=>(0,o.jsxs)("div",{className:W.footer,children:[(0,o.jsx)("a",{href:"https://github.com/psykzz/planning-poker",children:"source"})," | made by psykzz"]});var F=s(599),Q=e=>{let{children:r}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:F.container,children:r}),(0,o.jsx)(G,{}),(0,o.jsx)(L,{}),(0,o.jsx)(c.Ix,{hideProgressBar:!0,pauseOnHover:!1,position:"bottom-right"})]})},Y=()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a(),{children:(0,o.jsx)("title",{children:"Planning Poker"})}),(0,o.jsx)(Q,{children:(0,o.jsx)(U,{})})]})},8888:function(e){e.exports={darkmode_toggle:"styles_darkmode_toggle__bZJ0V",is_dark:"styles_is_dark__2CR2c"}},8447:function(e){e.exports={footer:"styles_footer__D62n0"}},2924:function(e){e.exports={content:"hero_content__F4E3Z",has_session:"hero_has_session__3uhXA",new_session:"hero_new_session__qGijp",existing_session:"hero_existing_session__ozIBV",existing_session_form:"hero_existing_session_form__wRydA"}},599:function(e){e.exports={container:"layout_container__qMHUx"}},2703:function(e){e.exports={moderator_notice:"moderatorcontrols_moderator_notice__7EP6Y",moderator_controls:"moderatorcontrols_moderator_controls__3bBUn",actions:"moderatorcontrols_actions__0s1xr",options:"moderatorcontrols_options__Bz1fG",reveal:"moderatorcontrols_reveal__i9mwx",reset:"moderatorcontrols_reset__CE4hG",confirm:"moderatorcontrols_confirm__uXEu2",sequence:"moderatorcontrols_sequence__tc0B8"}},5126:function(e){e.exports={copy_notice:"planningpoker_copy_notice__Ok_4M"}},5106:function(e){e.exports={card_container:"scorecards_card_container__AArXH",options:"scorecards_options__wnrnn",card:"scorecards_card__PZMDs",no_hover:"scorecards_no_hover__X7NmB",actions:"scorecards_actions__0gWOS",reveal:"scorecards_reveal__N83xB",reset:"scorecards_reset__KlXdH",moderator_notice:"scorecards_moderator_notice__9lWSI"}},8255:function(e){e.exports={user_list:"userlist_user_list__RlH__",two_columns:"userlist_two_columns__pjAlX",show_scores:"userlist_show_scores__JvQic",user:"userlist_user__nCIP5",self:"userlist_self__tyRhc",averages:"userlist_averages__00XBW",name:"userlist_name__9qEHJ",me:"userlist_me__jfW8z",card_container:"userlist_card_container__tkJNd",options:"userlist_options__OsG7q",card:"userlist_card__tOi5A",no_hover:"userlist_no_hover__a38_9",score:"userlist_score__wvQ9A",reset:"userlist_reset__CXNY9"}}},function(e){e.O(0,[348,888,774,179],function(){return e(e.s=5728)}),_N_E=e.O()}]);